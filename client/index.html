<!-- index.html -->

<html ng-app='myApp'>
<head>
	<title>Hash Fighters</title>

	<!-- Angular CDN -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>

    <!-- Jquery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

    <!-- Jquery UI CDN -->
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

	<!-- Jquery to -->
	<script src="jquery.time-to.js"></script>

    <!-- Bootstrap CDN -->
    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<!-- Animate Css -->
	<link rel="stylesheet" href="animate.css">

	<!-- Time JS CSS -->
	<link href="timeTo.css" type="text/css" rel="stylesheet"/>

	<!-- Font Awesome CDN -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

    <!-- Angular Code -->
    <script>

			function getRelativeDate(days, hours, minutes){
	            var date = new Date((new Date()).getTime() + 60000 /* milisec */ * 60 /* minutes */ * 24 /* hours */ * days /* days */);

	            date.setHours(hours || 0);
	            date.setMinutes(minutes || 0);
	            date.setSeconds(0);

	            return date;
	        }








    		
			var myApp = angular.module('myApp',['ngRoute']);


	    	// ROUTES ======================================================
			myApp.config(function ($routeProvider){
				$routeProvider
			        .when('/',{
			            templateUrl: 'partials/fight.html'
			        })
			        .when('/new',{
			            templateUrl: 'partials/results.html'
			        })
			        .otherwise({
			          redirectTo: '/'
			        });
			});



	    	// FACTORY =====================================================
	    	myApp.factory('TweetFactory', function($http){
	    		var factory = {};

	    		var batman_health = 0;
	    		var trump_health = 0;

	    		factory.getTweets = function(callback){
	    			$http.get('/get_Tweets').success(function(output){
	    				callback(output);
	    			})
	    		}

	    		factory.getAllTweets = function(callback){
	    			$http.get('/get_all_tweets').success(function(output){
	    				callback(output);
	    			})
	    		}

	    		factory.getTrumpHealth = function(callback){
	    			callback(trump_health);
	    		}

	    		factory.getBatmanHealth = function(callback){
	    			callback(batman_health);
	    		}

	    		factory.inc_trump_health = function(){
	    			// increase trump's health by x (which is 10)
	    			trump_health += 50;
	    		}

	    		factory.inc_batman_health = function(){
	    			// increase trump's health by x (which is 10)
	    			batman_health += 50;
	    		}

	    		factory.updateFightOne = function(callback){
	    			$http.post('/updateFightOneCount').success(function(output){
	    				callback(output);
	    			})
	    		}

	    		factory.get_all_poll = function(callback){
					$http.get('/getAllPoll').success(function(output){
						console.log(output);
						callback(output);
					})
				}

				factory.updateFightVote = function(id, callback){
					$http.post('/update_fight_count/' + id).success(function(output){
						callback(output);
					})
				}

	 

	    		return factory;
	    	})




	    	// CONTOLLER ===================================================
	    	myApp.controller('TweetController', function($scope, TweetFactory){

	    	// Get all polls
			TweetFactory.get_all_poll(function(data){
				console.log(data);
				$scope.allPoll = data;
			})




	    	var countdownTime = getRelativeDate(1);

			// Set timer countdown to specyfied date
	        //$('#countdown-2').timeTo(date);
	        $('#countdown-2').timeTo(countdownTime, function(){
	        	
	        


	        


	    	// Testing set interval time
			var startTime = new Date().getTime();

			var interval = setInterval(function(){


			    // invoke the factory method 'getTweets'
				TweetFactory.getTweets(function(data){

					console.log(data);
					var process_hash = data.tweet;
	    			console.log(process_hash);
	    			$scope.currentTweets = data;


					// TRUMP =====================================
    				// scan the string to find any match to #Trump
    				if(process_hash.match(/#dojotrump/) == "#dojotrump"){

    					// a call to factory to increase Trump's health
    					TweetFactory.inc_trump_health();
	    				
    					// a call to factory to get Trump's health
    					TweetFactory.getTrumpHealth(function(data){

			    			// if #trump is found, trigger this gif animation
		    				// if trump was voted, trigger Trump attack
		    				$('#trump').attr('src', '../images/trump_attack.gif');
		    				// if trump was voted, batman gets attacked
		    				$('#batman').attr('src', '../images/batman_attacked.gif');
		    				// trigger the logo rock gif
		    				$('#logo').attr('src', '../images/logo_rock.gif');

		    				
			    			// if trump health reaches 100, kill the time
			    			if(data == 100){
			    				$("#versus").hide();
			    				$('#trump').attr('src', '../images/trump_victory.png');
			    				$('#batman').attr('src', '../images/batman_defeat.png');
			    				clearInterval(interval);
			    			}

			    			$scope.trumpHealth = data;

			    			TweetFactory.getAllTweets(function(data){
			    				console.log(data);
			    				$scope.allTweets = data;
			    			}) 

			    		})
    				}
    				// BATMAN ===========================================
			    	else if(process_hash.match(/#dojobatman/) == "#dojobatman"){

			    		// a call to factory to increase Batman's health
			    		TweetFactory.inc_batman_health();

			    		// a call to factory to get Batman's health
			    		TweetFactory.getBatmanHealth(function(data){


			    			// if batman was voted, trigger Batman attack
							$('#batman').attr('src', '../images/batman_attack.gif');
							// if batman was voted, trump gets attacked
							$('#trump').attr('src', '../images/trump_attacked.gif');
							// trigger the logo rock gif
		    				$('#logo').attr('src', '../images/logo_rock.gif');
		    				//$('#logo').addClass('animated shake');

			    			console.log(data);
		    				
			    			// if batman's health reaches 100, kill the time
			    			if(data == 100){
			    				$("#versus").hide();
			    				$('#batman').attr('src', '../images/batman_victory.png');
			    				$('#trump').attr('src', '../images/trump_defeat.png');
			    				clearInterval(interval);
			    			}

			    			$scope.batmanHealth = data;

			    			TweetFactory.getAllTweets(function(data){
			    				console.log(data);
			    				$scope.allTweets = data;
			    			}) 
			    		})
			    	}


	    		}) // end of TweetFactory.getTweets
				
			}, 10000) // end of setIncrement, every 10 seconds run the above code

	
 }); // this is end of countdown-2

			// Voting
			$scope.fight_one = function(id){
				console.log(id);
				TweetFactory.updateFightVote(id, function(data){
					console.log(data);
				});

				TweetFactory.get_all_poll(function(data){
					console.log(data);
					$scope.allPoll = data;
				})
			}



	}) // end of TweetController 

	


</script>



</head>
	<body>

		
		<div ng-view=""></div>

		
	</body>
</html>






